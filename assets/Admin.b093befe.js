var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,i=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&l(e,a,t[a]);if(r)for(var a of r(t))s.call(t,a)&&l(e,a,t[a]);return e},o=(e,r)=>t(e,a(r));import{R as c,L as u,aa as d,ab as m,ac as f,ad as p,ae as h,af as g,ag as v,ah as b,ai as y,aj as E,ak as _,al as x,am as w,an as N,ao as k,ap as S,aq as A,ar as C,u as B,d as I,p as L,a as V,k as $,j as F,e as j,b as U,_ as M,$ as O,r as P,K as Q,G as T,g as q,as as R,at as D,a0 as z,Y as G,c as J,au as K,T as Y,x as H,J as W,av as X,aw as Z,ax as ee,v as te,a1 as ae,a2 as re,a3 as ne}from"./vendor.023c1acf.js";import{B as se,C as le,P as ie,g as oe,a as ce,b as ue,u as de,S as me,c as fe,d as pe}from"./index.71f51349.js";import{_ as he,F as ge,u as ve,a as be}from"./FormElement.fb0b0290.js";const ye=()=>c.createElement("header",{className:"space-x-16"},c.createElement("span",{className:"space-x-8"},c.createElement(u,{to:"/admin/doors"},c.createElement(se,{content:"Luker"})),c.createElement(u,{to:"/admin/doors/new"},c.createElement(se,null,"Ny luke"))),c.createElement("span",{className:"space-x-8"},c.createElement(u,{to:"/admin/service_messages"},c.createElement(se,{content:"Driftsmeldinger"})),c.createElement(u,{to:"/admin/service_messages/new"},c.createElement(se,null,"Ny driftsmelding"))));var Ee=d;var _e=function(e,t,a){for(var r=-1,n=e.length;++r<n;){var s=e[r],l=t(s);if(null!=l&&(void 0===i?l==l&&!Ee(l):a(l,i)))var i=l,o=s}return o},xe=m,we=function(e,t){return e<t};var Ne=function(e,t){return e&&e.length?_e(e,xe(t),we):void 0},ke=p,Se=h,Ae=f?f.isConcatSpreadable:void 0;var Ce=g,Be=function(e){return Se(e)||ke(e)||!!(Ae&&e&&e[Ae])};var Ie=function e(t,a,r,n,s){var l=-1,i=t.length;for(r||(r=Be),s||(s=[]);++l<i;){var o=t[l];a>0&&r(o)?a>1?e(o,a-1,r,n,s):Ce(s,o):n||(s[s.length]=o)}return s};var Le=d;var Ve=function(e,t){if(e!==t){var a=void 0!==e,r=null===e,n=e==e,s=Le(e),l=void 0!==t,i=null===t,o=t==t,c=Le(t);if(!i&&!c&&!s&&e>t||s&&l&&o&&!i&&!c||r&&l&&o||!a&&o||!n)return 1;if(!r&&!s&&!c&&e<t||c&&a&&n&&!r&&!s||i&&a&&n||!l&&n||!o)return-1}return 0};var $e=v,Fe=b,je=m,Ue=y,Me=function(e,t){var a=e.length;for(e.sort(t);a--;)e[a]=e[a].value;return e},Oe=E,Pe=function(e,t,a){for(var r=-1,n=e.criteria,s=t.criteria,l=n.length,i=a.length;++r<l;){var o=Ve(n[r],s[r]);if(o)return r>=i?o:o*("desc"==a[r]?-1:1)}return e.index-t.index},Qe=_,Te=h;var qe=Ie,Re=function(e,t,a){t=t.length?$e(t,(function(e){return Te(e)?function(t){return Fe(t,1===e.length?e[0]:e)}:e})):[Qe];var r=-1;t=$e(t,Oe(je));var n=Ue(e,(function(e,a,n){return{criteria:$e(t,(function(t){return t(e)})),index:++r,value:e}}));return Me(n,(function(e,t){return Pe(e,t,a)}))},De=w,ze=x((function(e,t){if(null==e)return[];var a=t.length;return a>1&&De(e,t[0],t[1])?t=[]:a>2&&De(t[0],t[1],t[2])&&(t=[t[0]]),Re(e,qe(t,1),[])})),Ge=N,Je=k;var Ke=function(e){return"number"==typeof e||Je(e)&&"[object Number]"==Ge(e)},Ye=he,He=S;var We=Ie;var Xe=function(e){return(null==e?0:e.length)?We(e,1):[]},Ze=A,et=C;var tt=function(e,t){return Ye(e,t,(function(t,a){return He(e,a)}))},at=function(e){return et(Ze(e,void 0,Xe),e+"")}((function(e,t){return null==e?{}:tt(e,t)}));const rt=async()=>await V.get("/admin/challenges").then((({data:e})=>$(e,"door"))),nt=e=>B(["admin","challenges"],rt,o(i({},e),{staleTime:6e5})),st=e=>B(["admin","challenges"],rt,{staleTime:6e5,select:e?L(e):void 0}),lt=e=>B(["admin","posts",e],(()=>(e=>V.get(`/admin/challenges/${e}/posts`).then((({data:e})=>e)))(e)),{staleTime:3e5}),it=(e,t)=>B(["admin","challenges","preview",e],(()=>(async e=>{if(e=at(e,["markdown_content","files"]),!F(e))return await V.post("/admin/challenge_markdown",{challenge:e}).then((({data:e})=>e))})(e)),i({staleTime:1/0,cacheTime:0},t)),ot=()=>{const e=j();return I(["admin","serviceMessages","update"],(e=>{var t=e,{uuid:a}=t,l=((e,t)=>{var a={};for(var l in e)n.call(e,l)&&t.indexOf(l)<0&&(a[l]=e[l]);if(null!=e&&r)for(var l of r(e))t.indexOf(l)<0&&s.call(e,l)&&(a[l]=e[l]);return a})(t,["uuid"]);return V.patch(`/admin/service_messages/${a}`,l)}),{onSuccess:()=>{e.invalidateQueries("serviceMessages")}})},ct=({door:e,setDoor:t})=>{const{data:a}=nt();return a?c.createElement("label",{className:"block space-x-4"},c.createElement("select",{className:"form-select",defaultValue:e,onChange:e=>t(parseInt(e.target.value))},U(ze(M(O(a)),"door"),(({door:e,title:t},a)=>c.createElement("option",{key:a,value:e,label:`Luke ${e}: ${t}`}))))):null};var ut=P.exports.memo((()=>{var e;const t=Q(),{search:a}=T(),r=null==(e=a.match(/door=(?<door>\d+)/))?void 0:e.groups,{data:n}=nt(),s=P.exports.useMemo((()=>Ne(O(n),"door")),[n]),{mutate:l,isLoading:i}=(()=>{const e=j();return I(["admin","challenges","destroy"],(async({door:e})=>Ke(e)&&V.delete(`/admin/challenges/${e}`)),{onSuccess:()=>{e.invalidateQueries("challenges"),e.invalidateQueries(["admin","challenges"])}})})(),[o,d]=P.exports.useState(r&&parseInt(r.door));P.exports.useLayoutEffect((()=>{d((e=>null!=e?e:null==s?void 0:s.door))}),[d,s]);const{data:m}=st(null!=o?o:null==s?void 0:s.door);return q(o)?null:c.createElement("div",{className:"space-y-door-elements"},c.createElement(le,{challenge:m,withoutInput:!0,preamble:c.createElement("div",{className:"w-full flex justify-between mb-8"},c.createElement(ct,{door:o,setDoor:d}),c.createElement("div",{className:"space-x-8"},c.createElement(u,{to:`/admin/doors/${o}/edit`},c.createElement(se,{disabled:i},"Rediger luke")),c.createElement(se,{disabled:i,onClick:()=>{window.confirm(`Er du sikker pÃ¥ at du vil slette luke ${o} "${null==m?void 0:m.title}"?`)&&l({door:o},{onSuccess:()=>{d(void 0),t.push("/admin/doors")}})}},"Slett luke")))}),c.createElement(ie,{door:o,usePosts:lt,withoutInput:!0}))}));var dt=R,mt=D,ft=m,pt=h,ht=function(e){if("function"!=typeof e)throw new TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}};var gt=function(e,t){return(pt(e)?dt:mt)(e,ht(ft(t)))};const vt=()=>{const{data:e}=nt();return gt(z(1,25),(t=>G(e,t)))};var bt={exports:{}},yt=bt.exports=function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function a(e,t){var a=e[0],r=e[1],n=e[2],s=e[3];r=((r+=((n=((n+=((s=((s+=((a=((a+=(r&n|~r&s)+t[0]-680876936|0)<<7|a>>>25)+r|0)&r|~a&n)+t[1]-389564586|0)<<12|s>>>20)+a|0)&a|~s&r)+t[2]+606105819|0)<<17|n>>>15)+s|0)&s|~n&a)+t[3]-1044525330|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((s=((s+=((a=((a+=(r&n|~r&s)+t[4]-176418897|0)<<7|a>>>25)+r|0)&r|~a&n)+t[5]+1200080426|0)<<12|s>>>20)+a|0)&a|~s&r)+t[6]-1473231341|0)<<17|n>>>15)+s|0)&s|~n&a)+t[7]-45705983|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((s=((s+=((a=((a+=(r&n|~r&s)+t[8]+1770035416|0)<<7|a>>>25)+r|0)&r|~a&n)+t[9]-1958414417|0)<<12|s>>>20)+a|0)&a|~s&r)+t[10]-42063|0)<<17|n>>>15)+s|0)&s|~n&a)+t[11]-1990404162|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((s=((s+=((a=((a+=(r&n|~r&s)+t[12]+1804603682|0)<<7|a>>>25)+r|0)&r|~a&n)+t[13]-40341101|0)<<12|s>>>20)+a|0)&a|~s&r)+t[14]-1502002290|0)<<17|n>>>15)+s|0)&s|~n&a)+t[15]+1236535329|0)<<22|r>>>10)+n|0,r=((r+=((n=((n+=((s=((s+=((a=((a+=(r&s|n&~s)+t[1]-165796510|0)<<5|a>>>27)+r|0)&n|r&~n)+t[6]-1069501632|0)<<9|s>>>23)+a|0)&r|a&~r)+t[11]+643717713|0)<<14|n>>>18)+s|0)&a|s&~a)+t[0]-373897302|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((s=((s+=((a=((a+=(r&s|n&~s)+t[5]-701558691|0)<<5|a>>>27)+r|0)&n|r&~n)+t[10]+38016083|0)<<9|s>>>23)+a|0)&r|a&~r)+t[15]-660478335|0)<<14|n>>>18)+s|0)&a|s&~a)+t[4]-405537848|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((s=((s+=((a=((a+=(r&s|n&~s)+t[9]+568446438|0)<<5|a>>>27)+r|0)&n|r&~n)+t[14]-1019803690|0)<<9|s>>>23)+a|0)&r|a&~r)+t[3]-187363961|0)<<14|n>>>18)+s|0)&a|s&~a)+t[8]+1163531501|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((s=((s+=((a=((a+=(r&s|n&~s)+t[13]-1444681467|0)<<5|a>>>27)+r|0)&n|r&~n)+t[2]-51403784|0)<<9|s>>>23)+a|0)&r|a&~r)+t[7]+1735328473|0)<<14|n>>>18)+s|0)&a|s&~a)+t[12]-1926607734|0)<<20|r>>>12)+n|0,r=((r+=((n=((n+=((s=((s+=((a=((a+=(r^n^s)+t[5]-378558|0)<<4|a>>>28)+r|0)^r^n)+t[8]-2022574463|0)<<11|s>>>21)+a|0)^a^r)+t[11]+1839030562|0)<<16|n>>>16)+s|0)^s^a)+t[14]-35309556|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((s=((s+=((a=((a+=(r^n^s)+t[1]-1530992060|0)<<4|a>>>28)+r|0)^r^n)+t[4]+1272893353|0)<<11|s>>>21)+a|0)^a^r)+t[7]-155497632|0)<<16|n>>>16)+s|0)^s^a)+t[10]-1094730640|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((s=((s+=((a=((a+=(r^n^s)+t[13]+681279174|0)<<4|a>>>28)+r|0)^r^n)+t[0]-358537222|0)<<11|s>>>21)+a|0)^a^r)+t[3]-722521979|0)<<16|n>>>16)+s|0)^s^a)+t[6]+76029189|0)<<23|r>>>9)+n|0,r=((r+=((n=((n+=((s=((s+=((a=((a+=(r^n^s)+t[9]-640364487|0)<<4|a>>>28)+r|0)^r^n)+t[12]-421815835|0)<<11|s>>>21)+a|0)^a^r)+t[15]+530742520|0)<<16|n>>>16)+s|0)^s^a)+t[2]-995338651|0)<<23|r>>>9)+n|0,r=((r+=((s=((s+=(r^((a=((a+=(n^(r|~s))+t[0]-198630844|0)<<6|a>>>26)+r|0)|~n))+t[7]+1126891415|0)<<10|s>>>22)+a|0)^((n=((n+=(a^(s|~r))+t[14]-1416354905|0)<<15|n>>>17)+s|0)|~a))+t[5]-57434055|0)<<21|r>>>11)+n|0,r=((r+=((s=((s+=(r^((a=((a+=(n^(r|~s))+t[12]+1700485571|0)<<6|a>>>26)+r|0)|~n))+t[3]-1894986606|0)<<10|s>>>22)+a|0)^((n=((n+=(a^(s|~r))+t[10]-1051523|0)<<15|n>>>17)+s|0)|~a))+t[1]-2054922799|0)<<21|r>>>11)+n|0,r=((r+=((s=((s+=(r^((a=((a+=(n^(r|~s))+t[8]+1873313359|0)<<6|a>>>26)+r|0)|~n))+t[15]-30611744|0)<<10|s>>>22)+a|0)^((n=((n+=(a^(s|~r))+t[6]-1560198380|0)<<15|n>>>17)+s|0)|~a))+t[13]+1309151649|0)<<21|r>>>11)+n|0,r=((r+=((s=((s+=(r^((a=((a+=(n^(r|~s))+t[4]-145523070|0)<<6|a>>>26)+r|0)|~n))+t[11]-1120210379|0)<<10|s>>>22)+a|0)^((n=((n+=(a^(s|~r))+t[2]+718787259|0)<<15|n>>>17)+s|0)|~a))+t[9]-343485551|0)<<21|r>>>11)+n|0,e[0]=a+e[0]|0,e[1]=r+e[1]|0,e[2]=n+e[2]|0,e[3]=s+e[3]|0}function r(e){var t,a=[];for(t=0;t<64;t+=4)a[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return a}function n(e){var t,a=[];for(t=0;t<64;t+=4)a[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return a}function s(e){var t,n,s,l,i,o,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)a(u,r(e.substring(t-64,t)));for(n=(e=e.substring(t-64)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)s[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(a(u,s),t=0;t<16;t+=1)s[t]=0;return l=(l=8*c).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(l[2],16),o=parseInt(l[1],16)||0,s[14]=i,s[15]=o,a(u,s),u}function l(e){var t,r,s,l,i,o,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)a(u,n(e.subarray(t-64,t)));for(r=(e=t-64<c?e.subarray(t-64):new Uint8Array(0)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)s[t>>2]|=e[t]<<(t%4<<3);if(s[t>>2]|=128<<(t%4<<3),t>55)for(a(u,s),t=0;t<16;t+=1)s[t]=0;return l=(l=8*c).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(l[2],16),o=parseInt(l[1],16)||0,s[14]=i,s[15]=o,a(u,s),u}function i(e){var a,r="";for(a=0;a<4;a+=1)r+=t[e>>8*a+4&15]+t[e>>8*a&15];return r}function o(e){var t;for(t=0;t<e.length;t+=1)e[t]=i(e[t]);return e.join("")}function c(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function u(e,t){var a,r=e.length,n=new ArrayBuffer(r),s=new Uint8Array(n);for(a=0;a<r;a+=1)s[a]=e.charCodeAt(a);return t?s:n}function d(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function m(e,t,a){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e)),r.set(new Uint8Array(t),e.byteLength),a?r:r.buffer}function f(e){var t,a=[],r=e.length;for(t=0;t<r-1;t+=2)a.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,a)}function p(){this.reset()}return o(s("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(a,r){var n,s,l,i,o=this.byteLength,c=t(a,o),u=o;return r!==e&&(u=t(r,o)),c>u?new ArrayBuffer(0):(n=u-c,s=new ArrayBuffer(n),l=new Uint8Array(s),i=new Uint8Array(this,c,n),l.set(i),s)}}(),p.prototype.append=function(e){return this.appendBinary(c(e)),this},p.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;t<=n;t+=64)a(this._hash,r(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},p.prototype.end=function(e){var t,a,r=this._buff,n=r.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)s[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(s,n),a=o(this._hash),e&&(a=f(a)),this.reset(),a},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},p.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(e,t){var r,n,s,l=t;if(e[l>>2]|=128<<(l%4<<3),l>55)for(a(this._hash,e),l=0;l<16;l+=1)e[l]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),s=parseInt(r[1],16)||0,e[14]=n,e[15]=s,a(this._hash,e)},p.hash=function(e,t){return p.hashBinary(c(e),t)},p.hashBinary=function(e,t){var a=o(s(e));return t?f(a):a},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(e){var t,r=m(this._buff.buffer,e,!0),s=r.length;for(this._length+=e.byteLength,t=64;t<=s;t+=64)a(this._hash,n(r.subarray(t-64,t)));return this._buff=t-64<s?new Uint8Array(r.buffer.slice(t-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(e){var t,a,r=this._buff,n=r.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n;t+=1)s[t>>2]|=r[t]<<(t%4<<3);return this._finish(s,n),a=o(this._hash),e&&(a=f(a)),this.reset(),a},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var e=p.prototype.getState.call(this);return e.buff=d(e.buff),e},p.ArrayBuffer.prototype.setState=function(e){return e.buff=u(e.buff,!0),p.prototype.setState.call(this,e)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(e,t){var a=o(l(new Uint8Array(e)));return t?f(a):a},p}();let Et=0;const _t=({challenge:e,register:t,setValue:a,className:r})=>{t("files");const{mutateAsync:n}=I(["admin","activeStorage","createBlob"],(({blob:e,config:t})=>V.post("/rails/active_storage/direct_uploads",{blob:e},t).then((({data:e})=>e)))),{mutateAsync:s}=I(["admin","activeStorage","uploadFile"],(({upload:{file:e,directUpload:t},config:a})=>V.put(t.url,e,o(i({},a),{headers:t.headers})))),[l,u]=P.exports.useState(U(e.files,(e=>o(i({},e),{fileId:Et++}))));P.exports.useEffect((()=>{a("files",U(l,"signed_id"))}),[a,l]);const[d,m]=P.exports.useState({}),f=(()=>{const e=P.exports.useRef(!0),t=P.exports.useCallback((()=>e.current),[]);return P.exports.useEffect((()=>()=>{e.current=!1}),[]),t})(),p=P.exports.useRef(null);return c.createElement("div",{className:J("space-y-2",r)},c.createElement(ge,{label:"Filer",note:"husk Ã¥ dobbeltsjekke riktig filnavn i markdown"},c.createElement("input",{ref:p,className:"hidden",type:"file",multiple:!0,onChange:({target:{files:e}})=>e&&(async e=>{await Promise.all(U(e,(async e=>{const t=Et++;m((e=>o(i({},e),{[t]:{progress:0}})));const a={filename:e.name,content_type:e.type,byte_size:e.size,checksum:btoa(yt.ArrayBuffer.hash(await e.arrayBuffer(),!0))},{signed_id:r,direct_upload:l}=await n({blob:a});f()&&(u((a=>[...a,{signed_id:r,filename:e.name,fileId:t}])),await s({upload:{file:e,directUpload:l},config:{onUploadProgress:e=>{f()&&m((a=>o(i({},a),{[t]:{progress:e.loaded/e.total}})))}}}),f()&&m((e=>o(i({},e),{[t]:{progress:1}}))))})))})(e)}),c.createElement(se,{className:"block form-input",type:"button",underline:!1,content:"Velg filer...",onClick:()=>{var e;return null==(e=p.current)?void 0:e.click()}})),c.createElement("div",{className:"grid grid-cols-4 gap-2"},U(l,(({filename:e,signed_id:t,fileId:a})=>{var r,n;const s=null!=(n=null==(r=d[a])?void 0:r.progress)?n:1;return c.createElement("span",{key:t,className:"relative overflow-hidden p-1 border-2 rounded-md border-lightbulb-yellow text-center"},s<1&&c.createElement("div",{style:{width:`calc(${100*s}% + ${.5*s}rem)`},className:"absolute top-[-.25rem] left-[-.25rem] h-[calc(100%+.5rem)] bg-blue-400 bg-opacity-20"}),c.createElement("span",{className:"inline-block w-[calc(100%-1.5rem)] line-clamp-1"},e),c.createElement(K,{className:"absolute top-0 right-2 h-full w-3 cursor-pointer",onClick:()=>u((e=>gt(e,{signed_id:t})))}))}))))};var xt=P.exports.memo((({challenge:e,newForm:t=!1,submit:a})=>{var r,n;const[s,l]=P.exports.useState(!1),{register:u,handleSubmit:d,setValue:m,getValues:f,watch:p,formState:{dirtyFields:{door:h}}}=ve({defaultValues:o(i({},e),{files:U(e.files,"signed_id")})}),[g,v]=P.exports.useState(),{data:b}=it(g,{enabled:s}),y=vt(),E=p("door"),_=null!=(r=e.active_from)?r:oe(h?E:e.door),x=null!=(n=e.active_to)?n:ce();return c.createElement("div",{className:"space-y-8"},c.createElement("form",{className:"space-y-4",onSubmit:d((t=>a(o(i({},t),{door:h?E:e.door}))))},c.createElement("div",{className:"space-x-4"},c.createElement(se,{type:"submit"},"Lagre"),c.createElement(se,{type:"button",className:"uppercase",onClick:()=>{l((e=>(v(e?void 0:f()),!e)))}},s?"Rediger":"ForhÃ¥ndsvisning")),c.createElement("div",{className:J("grid grid-cols-3 gap-4",s&&"hidden")},t&&c.createElement(ge,{label:"Luke",className:"col-span-3"},c.createElement("select",i({className:"block form-select",defaultValue:y[0]},u("door",{required:!0})),U(y,(e=>c.createElement("option",{key:e,value:e,label:H(e)}))))),c.createElement(be,i({label:"Tittel",type:"text",defaultValue:e.title},u("title",{required:!0}))),c.createElement(be,i({label:"Forfatter",type:"text",defaultValue:e.author},u("author",{required:!0}))),c.createElement(be,i({label:"Svar",note:"omringende whitespace blir ignorert",type:"text",defaultValue:e.answer},u("answer",{required:!0}))),c.createElement(be,{label:"Aktiv fra",disabled:!0,type:"datetime-local",value:ue(_)}),c.createElement(be,{label:"Aktiv til",disabled:!0,type:"datetime-local",value:ue(x)}),c.createElement(_t,{challenge:e,register:u,setValue:m,className:"col-span-3"}),c.createElement(ge,{label:"Innhold",note:"tittel-elementet blir erstattet med tittel fra over",className:"col-span-3"},c.createElement(Y,i({className:"block w-full form-textarea",rows:5,defaultValue:e.markdown_content},u("markdown_content",{required:!0})))))),s&&g&&b&&c.createElement(le,{withoutInput:!0,challenge:o(i({},g),{content:b.html})}))}));const wt=()=>{const{door:e}=W(),t=parseInt(e),a=Q(),{data:r,isLoading:n}=st(t),{mutate:s}=(()=>{const e=j();return I(["admin","challenges","update"],(({challenge:e})=>V.patch(`/admin/challenges/${e.door}`,{challenge:e})),{onSuccess:()=>{e.invalidateQueries("challenges"),e.invalidateQueries(["admin","challenges"])}})})();return P.exports.useEffect((()=>{n||r||a.push("/admin/doors/new")}),[n,r,a]),n||!r?null:c.createElement("div",{className:"space-y-8"},c.createElement("div",{className:"text-center"},c.createElement("span",{className:"text-4xl font-semibold"},"Luke ",t)),c.createElement(xt,{challenge:r,submit:e=>{s({challenge:e},{onSuccess:()=>a.push(`/admin/doors?door=${e.door}`)})}}))};var Nt=H,kt=/^\s+/,St=X.parseInt;var At=function(e,t,a){return a||null==t?t=0:t&&(t=+t),St(Nt(e).replace(kt,""),t||0)};var Ct=P.exports.memo((({serviceMessage:e,newForm:t=!1,submit:a})=>{var r,n,s,l,o;const{register:u,handleSubmit:d,setValue:m}=ve({defaultValues:i(i({},e),!t&&{resolved_at:ue(null!=(r=e.resolved_at)?r:Z(new Date))})}),{data:f}=nt({select:e=>U(ee(e),At)});return c.createElement("div",{className:"space-y-8"},c.createElement("form",{className:"space-y-4",onSubmit:d(a)},c.createElement("div",{className:"space-x-4"},c.createElement(se,{type:"submit"},"Lagre")),c.createElement("div",{className:J("grid grid-cols-3 gap-4")},c.createElement(be,i({label:"Innhold",type:"text",labelClassName:"col-span-3",className:"w-full",defaultValue:e.content},u("content",{required:!0}))),!t&&c.createElement(be,i({label:"LÃ¸sning",type:"text",labelClassName:"col-span-3",className:"w-full",defaultValue:null!=(n=e.resolution_content)?n:""},u("resolution_content",{setValueAs:e=>F(e)?null:e}))),c.createElement(ge,{label:"Luke",className:"col-span-3",defaultValue:null!=(s=e.resolution_content)?s:""},c.createElement("select",i({className:"block form-select",defaultValue:null!=(l=e.door)?l:void 0},u("door",{setValueAs:e=>F(e)?void 0:At(e)})),c.createElement("option",{label:"-",value:""}),U(f,(e=>c.createElement("option",{key:e,label:H(e),value:e}))))),!t&&c.createElement(c.Fragment,null,c.createElement(be,{label:"Opprettet",type:"datetime-local",value:ue(null!=(o=e.created_at)?o:""),disabled:!0}),c.createElement("div",null,c.createElement(be,i({label:"LÃ¸sningstidspunkt",type:"datetime-local"},u("resolved_at"))),c.createElement(se,{type:"button",className:"!text-xs",onClick:()=>m("resolved_at",null),content:"Nullstill"}))))))}));const Bt=()=>{const{uuid:e}=W(),t=Q(),{data:a,isLoading:r}=de({select:t=>te(t,{uuid:e})}),{mutate:n}=ot();return P.exports.useEffect((()=>{r||a||t.push("/admin/service_messages/new")}),[r,a,t]),r||!a?null:c.createElement("div",{className:"space-y-8"},c.createElement("div",{className:"text-center"},c.createElement("span",{className:"text-4xl font-semibold"},"Endre driftsmelding")),c.createElement(Ct,{serviceMessage:a,submit:a=>{n({uuid:e,service_message:a},{onSuccess:()=>t.push("/admin/service_messages")})}}))},It=()=>{const e=Q(),{mutate:t}=(()=>{const e=j();return I(["admin","challenges","create"],(({challenge:e})=>V.post("/admin/challenges",{challenge:e})),{onSuccess:()=>{e.invalidateQueries("challenges"),e.invalidateQueries(["admin","challenges"])}})})(),a=vt();return F(a)?c.createElement("div",{className:"text-center"},c.createElement("span",{className:"text-4xl font-semibold"},"Ingen ledige luker!")):c.createElement("div",{className:"space-y-8"},c.createElement("div",{className:"text-center"},c.createElement("span",{className:"text-4xl font-semibold"},"Ny luke")),c.createElement(xt,{newForm:!0,challenge:{door:a[0],title:"",author:"",answer:"",markdown_content:"",files:[]},submit:a=>{t({challenge:a},{onSuccess:()=>e.push(`/admin/doors?door=${a.door}`)})}}))},Lt=()=>{const e=Q(),{mutate:t}=(()=>{const e=j();return I(["admin","serviceMessages","create"],(e=>V.post("/admin/service_messages",e)),{onSuccess:()=>{e.invalidateQueries("serviceMessages")}})})();return c.createElement("div",{className:"space-y-8"},c.createElement("div",{className:"text-center"},c.createElement("span",{className:"text-4xl font-semibold"},"Ny driftsmelding")),c.createElement(Ct,{newForm:!0,serviceMessage:{content:"",resolution_content:null,resolved_at:null},submit:a=>{t({service_message:a},{onSuccess:()=>e.push("/admin/service_messages")})}}))},Vt=()=>{const{data:e,isLoading:t}=de(),{mutate:a}=(()=>{const e=j();return I(["admin","serviceMessages","delete"],(({uuid:e})=>V.delete(`/admin/service_messages/${e}`)),{onSuccess:()=>{e.invalidateQueries("serviceMessages")}})})();return t?null:c.createElement(c.Fragment,null,c.createElement("div",{className:"text-center"},c.createElement("h1",{className:"text-4xl font-semibold"},"Driftsmeldinger")),c.createElement("div",{className:"grid grid-cols-1 gap-6 justify-items-center"},F(e)?c.createElement("div",null,"ð Ingen driftsmeldinger. Livet er herlig! ð"):U(e,(e=>{const t=e.resolved_at?"border-lightbulb-yellow border-opacity-70 text-gray-700 text-opacity-70":"border-red-700 border-opacity-70";return c.createElement("div",{key:e.uuid,className:"w-full max-w-[40rem]"},c.createElement("div",{className:"m-2 space-x-4"},c.createElement(u,{to:`/admin/service_messages/${e.uuid}/edit`},c.createElement(se,{content:"Rediger"})),c.createElement(se,{content:"Slett",onClick:()=>{return t=e.uuid,void(window.confirm("Sikker pÃ¥ at du vil slette driftsmelding?")&&a({uuid:t}));var t}})),c.createElement(me,{className:J("border-2 p-4 rounded-md w-full",t),serviceMessage:e}))}))))},$t=()=>{const e=Q(),{data:t,isLoading:a}=fe();return a||t&&t.is_admin||e.push("/"),c.createElement(pe,{className:"py-12 px-8 md:px-12 mx-4 md:mx-8 bg-gray-100 text-gray-700 rounded-md space-y-8"},c.createElement(ye,null),c.createElement(ae,null,c.createElement(re,{exact:!0,path:"/admin/doors",component:ut}),c.createElement(re,{path:"/admin/doors/new",component:It}),c.createElement(re,{path:"/admin/doors/:door/edit",component:wt}),c.createElement(re,{exact:!0,path:"/admin/service_messages",component:Vt}),c.createElement(re,{path:"/admin/service_messages/new",component:Lt}),c.createElement(re,{path:"/admin/service_messages/:uuid/edit",component:Bt}),c.createElement(ne,{to:"/admin/doors"})))};export{$t as default};
