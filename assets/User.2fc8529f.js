var e=Object.defineProperty,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,l=(e,l)=>{for(var n in l||(l={}))r.call(l,n)&&s(e,n,l[n]);if(t)for(var n of t(l))a.call(l,n)&&s(e,n,l[n]);return e};import{ae as n,a9 as m,aC as o,R as i,K as c,r as u,f as d,z as p,P as E,G as b,L as k,$ as f,a0 as v,a1 as g}from"./vendor.27a690fc.js";import{d as w,s as y,e as N,B as x,f as h,c as S,h as L,i as _,j as C,k as D,l as P}from"./index.693383d0.js";import{_ as j,u as B,a as F,F as O}from"./FormElement.390fe831.js";var R=Array.prototype.join;var q=function(e,t){return null==e?"":R.call(e,t)},T=n,U=m,V=j,G=o;var I=function(e,t){if(null==e)return{};var r=T(G(e),(function(e){return[e]}));return t=U(t),V(e,r,(function(e,r){return t(e,r[0])}))};const A=({title:e,onSubmit:t,children:r})=>{const a=t?"form":"div";return i.createElement(w,{className:"max-w-[36rem] mx-auto py-12 px-8 md:px-12 bg-gray-100 text-gray-700 rounded-md space-y-8 grid place-content-center children:w-[clamp(16rem,50vw,24rem)]"},i.createElement("h1",{className:"text-center text-4xl font-semibold"},e),i.createElement(a,{className:"space-y-8",onSubmit:t},r))},K=({error:e})=>e?i.createElement("div",{className:"!mt-0"},i.createElement("em",{className:"text-red-700"},e.message)):null,$=y("\n  Er du sikker på at du vil slette brukeren din? Du vil ikke lenger være med i premietrekningen. Dette kan ikke reverseres.\n"),z=({user:e,submit:t,submitError:r,newForm:a=!1})=>{const s=c(),{register:n,handleSubmit:m,watch:o,setValue:b,reset:k,setError:f,clearErrors:v,formState:{isSubmitting:g,isSubmitSuccessful:w,errors:y,isDirty:S,dirtyFields:L}}=B();u.exports.useEffect((()=>{var t,r;a||(k({email:null!=(t=null==e?void 0:e.email)?t:"",username:null!=(r=null==e?void 0:e.username)?r:""}),v())}),[a,e,k,v]),u.exports.useEffect((()=>{d(null==r?void 0:r.errors,((e,t)=>f(t,{message:q(e,", ")})))}),[r,f]);const{mutate:_}=N(),C=u.exports.useRef(null),D=o("username"),P=o("avatar"),j=o("avatar_url"),[R]=p(j,500);return i.createElement(A,{title:a?"Ny bruker":"Rediger bruker",onSubmit:m((e=>{(a||!L.email||window.confirm("Du vil motta en e-post med instrukser for å re-aktivere din konto for en ny e-postadresse."))&&t(a?e:I(e,((e,t)=>!0===L[t])))}))},i.createElement("div",null,i.createElement(F,l({autoFocus:a,label:"E-post",note:"Innlogging og kontakt ved premiering.",type:"email",maxLength:128,className:"w-full"},n("email",{required:a}))),i.createElement(K,{error:y.email}),a&&i.createElement(E,null,i.createElement(E.Button,null,i.createElement("div",{className:"text-opacity-30 text-gray-700"},"Jobber du i Knowit?")),i.createElement(E.Panel,{className:"bg-gray-200 rounded p-2"},"Du vil ikke kunne delta i premietrekningen. Vennligst registrer deg med Knowit-adresse.")),i.createElement(F,l({label:"Passord",note:a?void 0:"La være blank for å beholde passord",type:"password",minLength:8,maxLength:128,labelClassName:"mt-4",className:"w-full"},n("password",{required:a}))),i.createElement(K,{error:y.password}),i.createElement(F,l({label:"Bekreft passord",type:"password",minLength:8,maxLength:128,labelClassName:"mt-4",className:"w-full"},n("password_confirmation",{required:a}))),i.createElement(K,{error:y.password_confirmation})),i.createElement("div",{className:"!mt-12"},i.createElement("div",{className:"text-opacity-60 text-gray-700"},i.createElement("em",null,"Dersom du vil delta i kommentarfeltet.",i.createElement("br",null),"Brukernavnet vises i kommentarfeltet og på ledertavlen.",a&&" Du kan endre dette senere.")),i.createElement(F,l({autoComplete:"nickname",label:"Brukernavn",type:"text",maxLength:30,labelClassName:"mt-1",className:"w-full"},n("username"))),i.createElement(K,{error:y.username}),/^.+@.+\..+$/.test(null!=D?D:"")&&i.createElement(K,{error:{type:"pattern",message:"Dette ser ut som en e-postadresse! Er du sikker på at du mente å sette dette som brukernavn (synlig for alle)?"}}),i.createElement(O,{label:"Profilbilde",className:"mt-4 w-full"},i.createElement("input",{ref:C,className:"hidden",type:"file",accept:"image/*",onChange:e=>{var t;v("avatar");const r=null==(t=e.target.files)?void 0:t[0];r&&(r.size>2097152?f("avatar",{message:"for stort"}):b("avatar",r,{shouldDirty:!0}))}}),i.createElement(x,{className:"block h-12 max-w-full line-clamp-1 form-input",type:"button",underline:!1,content:P?P.name:"Velg bilde (maks 2MB)",onClick:()=>{var e;return null==(e=C.current)?void 0:e.click()}}),i.createElement(K,{error:y.avatar})),i.createElement("input",l({type:"url",maxLength:256,placeholder:"... eller oppgi URL",className:"mt-1 form-input w-full"},n("avatar_url"))),(P||R||(null==e?void 0:e.avatar))&&i.createElement("img",{className:"my-2 w-avatar",src:R||P&&URL.createObjectURL(P)||(null==e?void 0:e.avatar)||""}),i.createElement(K,{error:y.avatar_url})),!a&&S&&!g&&w&&!r&&i.createElement(h,{wrapperClassName:"mx-auto w-16",message:"Lagret!"}),i.createElement(x,{type:"submit",disabled:!S||g,underline:!1,className:"mt-8 block mx-auto",content:a?"Opprett bruker":"Lagre"}),!a&&i.createElement(x,{type:"button",onClick:()=>{window.confirm($)&&_(null,{onSuccess:()=>s.push("/")})},underline:!1,className:"mt-4 block mx-auto text-red-700",content:"Slett bruker"}))},H=()=>{const{data:e,isLoading:t}=S(),{mutateAsync:r,error:a}=L();return t||!e||e.is_guest?null:i.createElement(z,{user:e,submit:r,submitError:a})},J=()=>{var e,t;const{search:r}=b(),a=null==(e=r.match(/email=(?<email>\S+)/))?void 0:e.groups,{register:s,handleSubmit:n,formState:{isSubmitSuccessful:m}}=B(),{mutate:o,error:c,isLoading:u}=_();return!m||u||c?i.createElement(A,{title:"Glemt passord",onSubmit:n((e=>{o(e)}))},i.createElement(F,l({autoFocus:!0,label:"E-post",type:"email",defaultValue:decodeURIComponent(null!=(t=null==a?void 0:a.email)?t:""),className:"w-full"},s("email"))),i.createElement(x,{type:"submit",className:"block mx-auto",content:"Send tilbakestillingsinstrukser"})):i.createElement(A,{title:"Tilbakestillingsinstrukser sendt"},i.createElement("div",{className:"text-center"},"Dersom det finnes en konto med e-postadressen du oppga vil du snarlig få en e-post med instrukser for å tilbakestille ditt passord."))},M=()=>{var e;const{search:t}=b(),r=null==(e=t.match(/reset_password_token=(?<resetPasswordToken>\S+)/))?void 0:e.groups,{register:a,handleSubmit:s,setValue:n,setError:m,formState:{errors:o,isSubmitSuccessful:c}}=B(),{mutate:p,error:E,isLoading:k}=C();u.exports.useEffect((()=>{d(null==E?void 0:E.errors,((e,t)=>m(t,{message:q(e,", ")})))}),[E,m]),u.exports.useEffect((()=>{var e;n("reset_password_token",null!=(e=null==r?void 0:r.resetPasswordToken)?e:"")}),[n,r]);return!c||k||E?i.createElement(A,{title:"Tilbakestill passord",onSubmit:s((e=>{p(e)}))},i.createElement(F,l({label:"Passord",type:"password",labelClassName:"mt-4",className:"w-full"},a("password",{required:!0}))),i.createElement(K,{error:o.password}),i.createElement(F,l({label:"Bekreft passord",type:"password",labelClassName:"mt-4",className:"w-full"},a("password_confirmation",{required:!0}))),i.createElement(K,{error:o.password_confirmation}),i.createElement(x,{type:"submit",className:"block mx-auto",content:"Tilbakestill passord"})):i.createElement(A,{title:"Passord tilbakestilt"},i.createElement("div",{className:"text-center"},"Du kan nå logge inn med ditt nye passord."))},Q=()=>{const e=c(),{register:t,handleSubmit:r,watch:a}=B(),{mutate:s,error:n}=D(),m=a("email");return i.createElement(A,{title:"Logg inn",onSubmit:r((t=>{s(t,{onSuccess:()=>e.push("/")})}))},i.createElement("div",null,i.createElement(F,l({autoFocus:!0,label:"E-post",type:"email",className:"w-full"},t("email"))),i.createElement(F,l({label:"Passord",type:"password",labelClassName:"mt-4",className:"w-full"},t("password"))),n&&i.createElement("div",null,i.createElement("em",{className:"text-red-700"},n.error)),i.createElement(x,{type:"submit",className:"mt-6 block mx-auto",content:"Logg inn"}),i.createElement(k,{to:"/users/sign_up",className:"mt-6 block text-center"},i.createElement(x,{type:"button",sm:!0,content:"Ny bruker?"})),i.createElement(k,{to:`/users/lost_password?email=${encodeURIComponent(null!=m?m:"")}`,className:"mt-2 block text-center"},i.createElement(x,{type:"button",sm:!0,content:"Glemt passord?"}))))},W=()=>{const e=c(),{mutateAsync:t,error:r,isSuccess:a}=P();return a?i.createElement(A,{title:"Bruker opprettet"},i.createElement("p",{className:"text-center"},"Du vil snart motta en e-post med instrukser for å aktivere din konto."),i.createElement("p",{className:"text-center"},"Du vil kunne delta i kalenderen allerede nå, men du vil ikke være med i premietrekningen dersom du ikke aktiverer din konto."),i.createElement("p",{className:"text-center"},"P.S. Husk å sjekke spam-mappa di!"),i.createElement(x,{className:"block mx-auto",onClick:()=>e.push("/"),content:"Gå til lukene"})):i.createElement(z,{submit:t,submitError:r,newForm:!0})},X=()=>i.createElement(f,null,i.createElement(v,{path:"/users/edit",component:H}),i.createElement(v,{path:"/users/sign_in",component:Q}),i.createElement(v,{path:"/users/sign_up",component:W}),i.createElement(v,{path:"/users/lost_password",component:J}),i.createElement(v,{path:"/users/password/edit",component:M}),i.createElement(g,{to:"/users/edit"}));export{X as default};
