import{f as O,_ as H,ae as J,R as e,a5 as $,af as z,H as P,G as w,ag as B,ah as W,ai as Q,aj as U,B as b,ak as X,a4 as Y,al as Z,I as q,am as F,an as ee,ao as te,L as D,ap as ae,a6 as se,a7 as h,a8 as re}from"./index.fbe837f0.js";import{_ as ne,u as _,a as d,F as le}from"./FormElement.53e49fb2.js";var oe=Array.prototype,me=oe.join;function ce(t,s){return t==null?"":me.call(t,s)}var A=ce,ie=O,ue=H,de=ne,pe=J;function Ee(t,s){if(t==null)return{};var r=ie(pe(t),function(a){return[a]});return s=ue(s),de(t,r,function(a,l){return s(a,l[0])})}var ge=Ee;const x=({title:t,onSubmit:s,children:r})=>{const a=s?"form":"div";return e.createElement($,{className:"max-w-[36rem] mx-auto py-12 px-8 md:px-12 bg-gray-100 text-gray-700 rounded-md space-y-8 grid place-content-center children:w-[clamp(16rem,50vw,24rem)]"},e.createElement("h1",{className:"text-center text-4xl font-semibold"},t),e.createElement(a,{className:"space-y-8",onSubmit:s},r))},u=({error:t})=>t?e.createElement("div",{className:"!mt-0"},e.createElement("em",{className:"text-red-700"},t.message)):null,fe=z(`
  Er du sikker p\xE5 at du vil slette brukeren din? Du vil ikke lenger v\xE6re med i premietrekningen. Dette kan ikke reverseres.
`),T=({user:t,submit:s,submitError:r,newForm:a=!1})=>{const l=P(),{register:n,handleSubmit:p,watch:m,setValue:k,reset:c,setError:E,clearErrors:y,formState:{isSubmitting:v,isSubmitSuccessful:g,errors:f,isDirty:C,dirtyFields:V}}=_();w.exports.useEffect(()=>{var o,i;a||(c({email:(o=t==null?void 0:t.email)!=null?o:"",username:(i=t==null?void 0:t.username)!=null?i:""}),y())},[a,t,c,y]),w.exports.useEffect(()=>{B(r==null?void 0:r.errors,(o,i)=>E(i,{message:A(o,", ")}))},[r,E]);const{mutate:K}=W(),R=w.exports.useRef(null),L=m("username"),N=m("avatar"),j=m("avatar_url"),[I]=Q(j,500),G=o=>{s(a?o:ge(o,(i,S)=>V[S]===!0))},M=()=>{window.confirm(fe)&&K(null,{onSuccess:()=>l.push("/")})};return e.createElement(x,{title:a?"Ny bruker":"Rediger bruker",onSubmit:p(G)},e.createElement("div",null,e.createElement(d,{autoFocus:a,label:"E-post",note:"Innlogging og kontakt ved premiering.",type:"email",maxLength:128,className:"w-full",...n("email",{required:a})}),e.createElement(u,{error:f.email}),a&&e.createElement(U,null,e.createElement(U.Button,{tabIndex:-1},e.createElement("div",{className:"text-opacity-30 text-gray-700"},"Jobber du i Knowit?")),e.createElement(U.Panel,{className:"bg-gray-200 rounded p-2"},"Du vil ikke kunne delta i premietrekningen. Vennligst registrer deg med Knowit-adresse.")),e.createElement(d,{label:"Passord",note:a?void 0:"La v\xE6re blank for \xE5 beholde passord",type:"password",minLength:8,maxLength:128,labelClassName:"mt-4",className:"w-full",...n("password",{required:a})}),e.createElement(u,{error:f.password}),e.createElement(d,{label:"Bekreft passord",type:"password",minLength:8,maxLength:128,labelClassName:"mt-4",className:"w-full",...n("password_confirmation",{required:a})}),e.createElement(u,{error:f.password_confirmation})),e.createElement("div",{className:"!mt-12"},e.createElement("div",{className:"text-opacity-60 text-gray-700"},e.createElement("em",null,"Dersom du vil delta i kommentarfeltet.",e.createElement("br",null),"Brukernavnet vises i kommentarfeltet og p\xE5 ledertavlen.",a&&" Du kan endre dette senere.")),e.createElement(d,{autoComplete:"nickname",label:"Brukernavn",type:"text",maxLength:30,labelClassName:"mt-1",className:"w-full",...n("username")}),e.createElement(u,{error:f.username}),/^.+@.+\..+$/.test(L!=null?L:"")&&e.createElement(u,{error:{type:"pattern",message:"Dette ser ut som en e-postadresse! Er du sikker p\xE5 at du mente \xE5 sette dette som brukernavn (synlig for alle)?"}}),e.createElement(le,{label:"Profilbilde",className:"mt-4 w-full"},e.createElement("input",{ref:R,className:"hidden",type:"file",accept:"image/*",onChange:o=>{var S;y("avatar");const i=(S=o.target.files)==null?void 0:S[0];if(!!i){if(i.size>2*1024*1024){E("avatar",{message:"for stort"});return}k("avatar",i,{shouldDirty:!0})}}}),e.createElement(b,{className:"block h-12 max-w-full line-clamp-1 form-input",type:"button",underline:!1,content:N?N.name:"Velg bilde (maks 2MB)",onClick:()=>{var o;return(o=R.current)==null?void 0:o.click()}}),e.createElement(u,{error:f.avatar})),e.createElement("input",{type:"url",maxLength:256,placeholder:"... eller oppgi URL",className:"mt-1 form-input w-full",...n("avatar_url")}),(N||I||(t==null?void 0:t.avatar))&&e.createElement("img",{className:"my-2 w-avatar",src:I||N&&URL.createObjectURL(N)||(t==null?void 0:t.avatar)||""}),e.createElement(u,{error:f.avatar_url})),!a&&C&&!v&&g&&!r&&e.createElement(X,{wrapperClassName:"mx-auto w-16",message:"Lagret!"}),e.createElement(b,{type:"submit",disabled:!C||v,underline:!1,className:"mt-8 block mx-auto",content:a?"Opprett bruker":"Lagre"}),!a&&e.createElement(b,{type:"button",onClick:M,underline:!1,className:"mt-4 block mx-auto text-red-700",content:"Slett bruker"}))},be=()=>{const{data:t,isLoading:s}=Y(),{mutateAsync:r,error:a}=Z();return s||!t||t.is_guest?null:e.createElement(T,{user:t,submit:r,submitError:a})},ke=()=>{var c,E;const{search:t}=q(),s=(c=t.match(/email=(?<email>\S+)/))==null?void 0:c.groups,{register:r,handleSubmit:a,formState:{isSubmitSuccessful:l}}=_(),{mutate:n,error:p,isLoading:m}=F(),k=y=>{n(y)};return l&&!m&&!p?e.createElement(x,{title:"Tilbakestillingsinstrukser sendt"},e.createElement("div",{className:"text-center"},"Dersom det finnes en konto med e-postadressen du oppga vil du snarlig f\xE5 en e-post med instrukser for \xE5 tilbakestille ditt passord.")):e.createElement(x,{title:"Glemt passord",onSubmit:a(k)},e.createElement(d,{autoFocus:!0,label:"E-post",type:"email",defaultValue:decodeURIComponent((E=s==null?void 0:s.email)!=null?E:""),className:"w-full",...r("email")}),e.createElement(b,{type:"submit",className:"block mx-auto",content:"Send tilbakestillingsinstrukser"}))},ye=()=>{var v;const{search:t}=q(),s=(v=t.match(/reset_password_token=(?<resetPasswordToken>\S+)/))==null?void 0:v.groups,{register:r,handleSubmit:a,setValue:l,setError:n,formState:{errors:p,isSubmitSuccessful:m}}=_(),{mutate:k,error:c,isLoading:E}=ee();w.exports.useEffect(()=>{B(c==null?void 0:c.errors,(g,f)=>n(f,{message:A(g,", ")}))},[c,n]),w.exports.useEffect(()=>{var g;l("reset_password_token",(g=s==null?void 0:s.resetPasswordToken)!=null?g:"")},[l,s]);const y=g=>{k(g)};return m&&!E&&!c?e.createElement(x,{title:"Passord tilbakestilt"},e.createElement("div",{className:"text-center"},"Du kan n\xE5 logge inn med ditt nye passord.")):e.createElement(x,{title:"Tilbakestill passord",onSubmit:a(y)},e.createElement(d,{label:"Passord",type:"password",labelClassName:"mt-4",className:"w-full",...r("password",{required:!0})}),e.createElement(u,{error:p.password}),e.createElement(d,{label:"Bekreft passord",type:"password",labelClassName:"mt-4",className:"w-full",...r("password_confirmation",{required:!0})}),e.createElement(u,{error:p.password_confirmation}),e.createElement(b,{type:"submit",className:"block mx-auto",content:"Tilbakestill passord"}))},xe=()=>{const t=P(),{register:s,handleSubmit:r,watch:a}=_(),{mutate:l,error:n}=te(),p=k=>{l(k,{onSuccess:()=>t.push("/")})},m=a("email");return e.createElement(x,{title:"Logg inn",onSubmit:r(p)},e.createElement("div",null,e.createElement(d,{autoFocus:!0,label:"E-post",type:"email",className:"w-full",...s("email")}),e.createElement(d,{label:"Passord",type:"password",labelClassName:"mt-4",className:"w-full",...s("password")}),n&&e.createElement("div",null,e.createElement("em",{className:"text-red-700"},n.error)),e.createElement(b,{type:"submit",className:"mt-6 block mx-auto",content:"Logg inn"}),e.createElement(D,{to:"/users/sign_up",className:"mt-6 block text-center"},e.createElement(b,{type:"button",sm:!0,content:"Ny bruker?"})),e.createElement(D,{to:`/users/lost_password?email=${encodeURIComponent(m!=null?m:"")}`,className:"mt-2 block text-center"},e.createElement(b,{type:"button",sm:!0,content:"Glemt passord?"}))))},ve=()=>{const t=P(),{mutateAsync:s,error:r}=ae(),a=l=>{s(l,{onSuccess:()=>t.push("/")})};return e.createElement(T,{submit:a,submitError:r,newForm:!0})},we=()=>e.createElement(se,null,e.createElement(h,{path:"/users/edit",component:be}),e.createElement(h,{path:"/users/sign_in",component:xe}),e.createElement(h,{path:"/users/sign_up",component:ve}),e.createElement(h,{path:"/users/lost_password",component:ke}),e.createElement(h,{path:"/users/password/edit",component:ye}),e.createElement(re,{to:"/users/edit"}));export{we as default};
